<!-- Table of Question Groups -->
<div class="d-flex justify-content-between align-items-center customTitle mt-4">
    <span>2. Question Groups</span>
    <div class="d-flex justify-content-end">
        <button cButton type="button" (click)="toggleCreateQuestionGroupModal()"
            class="btn-success text-white d-flex align-items-center">
            <svg [cIcon]="icons.cilPlus" width="22" class="text-white" title="Plus Icon"></svg>
        </button>
    </div>
</div>
@if(questionGroups.length > 0) {
<table cTable>
    <thead>
        <tr>
            <th scope="col">No.</th>
            <th scope="col">NameEN</th>
            <th scope="col">NameVN</th>
            <th scope="col">Priority</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @for(item of questionGroups; track $index; let i = $index) {
        <tr class="tree-row" [class.expanded]="item.expanded">
            <td>{{ i + 1 }}</td>
            <td>{{ item.nameEN }}</td>
            <td>{{ item.nameVN }}</td>
            <td>{{ item.priority }}</td>
            <td class="text-end">
                @if((item?.questions?.length ?? 0) > 0) {
                <button (click)="toggleQuestionNode(item)" class="btn btn-info me-2">
                    <app-book-icon [open]="item.expanded ?? false" [size]="20"></app-book-icon>
                </button>
                }
                <button cButton type="button" (click)="toggleCreateQuestionModal(i)" class="btn-success text-white me-2">
                    <svg [cIcon]="icons.cilPlus" width="20" class="text-white" title="Edit Icon"></svg>
                </button>
                <button cButton type="button" (click)="updateQuestionGroup(i)" class="btn-primary text-white me-2">
                    <svg [cIcon]="icons.cilPen" width="20" class="text-white" title="Edit Icon"></svg>
                </button>
                <button cButton type="button" (click)="deleteQuestionGroup(i)" class="btn-danger text-white">
                    <svg [cIcon]="icons.cilTrash" width="20" class="text-white" title="Trash Icon"></svg>
                </button>
            </td>
        </tr>
        @if(item.expanded && (item?.questions?.length ?? 0) > 0) {
        @for(item1 of item.questions; track $index; let j = $index) {
        <ng-container>
            <ng-container [ngTemplateOutlet]="questionTemplate"
                [ngTemplateOutletContext]="{ node: item1, index: j, level: 1, questionGroupIndex: i }"></ng-container>
        </ng-container>
        }
        }
        }
    </tbody>
</table>
} @else {
<div class="pt-4">
    <p class="text-center opacity-50"> No question group available. Click Button Add to get started.</p>
</div>
}

<!-- Table of Questions -->
<div class="d-flex justify-content-between align-items-center customTitle mt-4">
    <span>3. Questions</span>
    <div class="d-flex justify-content-end">
        <button cButton type="button" (click)="toggleCreateQuestionModal()"
            class="btn-success text-white d-flex align-items-center">
            <svg [cIcon]="icons.cilPlus" width="22" class="text-white" title="Plus Icon"></svg>
        </button>
    </div>
</div>
@if(questions.length > 0) {
<table cTable>
    <thead>
        <tr>
            <th scope="col">No.</th>
            <th scope="col">NameEN</th>
            <th scope="col">NameVN</th>
            <th scope="col">Priority</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @for(item of questions; track $index; let i = $index) {
        <ng-container>
            <ng-container [ngTemplateOutlet]="questionTemplate"
                [ngTemplateOutletContext]="{ node: item, index: i, level: 0, questionGroupIndex: -1 }"></ng-container>
        </ng-container>
        }
    </tbody>
</table>
} @else {
<div class="pt-4">
    <p class="text-center opacity-50">No question available. Click Button Add to get started.</p>
</div>
}

<!-- Question Template -->
<ng-template #questionTemplate let-node="node" let-level="level" let-index="index" let-questionGroupIndex="questionGroupIndex">
    <tr class="tree-row" [class.expanded]="node.expanded" [class.children]="level > 0">
        <td>
            <span [ngStyle]="{'margin-left.px': level * 15}">
                {{ index + 1 }}
            </span>
        </td>
        <td>{{ node.nameEN }}</td>
        <td>{{ node.nameVN }}</td>
        <td>{{ node.priority }}</td>
        <td class="text-end">
            @if((node.predefinedAnswers?.length ?? 0) > 0) {
            <button (click)="togglePredefinedAnswerNode(node)" class="btn btn-info me-2">
                <app-book-icon [open]="node.expanded ?? false" [size]="20"></app-book-icon>
            </button>
            }
            <button cButton type="button" (click)="updateQuestion(index, questionGroupIndex)" class="btn-primary text-white me-2">
                <svg [cIcon]="icons.cilPen" width="20" class="text-white" title="Edit Icon"></svg>
            </button>
            <button cButton type="button" (click)="deleteQuestion(index, questionGroupIndex)" class="btn-danger text-white">
                <svg [cIcon]="icons.cilTrash" width="20" class="text-white" title="Trash Icon"></svg>
            </button>
        </td>
    </tr>
    @if(node.expanded && (node?.predefinedAnswers?.length ?? 0) > 0) {
    @for(item1 of node.predefinedAnswers; track $index; let j = $index) {
    <ng-container>
        <ng-container [ngTemplateOutlet]="predefinedAnswerTemplate"
            [ngTemplateOutletContext]="{ node: item1, index: j, level: level + 1 }"></ng-container>
    </ng-container>
    }
    }
</ng-template>
<ng-template #predefinedAnswerTemplate let-node="node" let-level="level" let-index="index">
    <tr class="tree-row" [class.expanded]="node.expanded" [class.children]="level > 0">
        <td>
            <span [ngStyle]="{'margin-left.px': level * 15}">
                {{ index + 1 }}
            </span>
        </td>
        <td>{{ node.nameVN }}</td>
        <td>{{ node.nameEN }}</td>
        <td>{{ node.priority }}</td>
        <td>###</td>
    </tr>
</ng-template>

<!-- Create Question Group Modal -->
<c-modal id="visibleCreateQuestionGroupModal" [visible]="visibleCreateQuestionGroupModal()" size="lg" backdrop="static"
    (visibleChange)="handleCreateQuestionGroupModalChange($event)">
    <c-modal-header class="bg-success d-flex justify-content-between align-items-center">
        <h5 cModalTitle class="fw-bold text-white">Create Question Group</h5>
        <button (click)="toggleCreateQuestionGroupModal()" class="btn btn-sm btnClose">
            <svg [cIcon]="icons.cilX" width="22" class="text-white" title="Close Icon"></svg>
        </button>
    </c-modal-header>
    <c-modal-body>
        <div class="mb-4">
            <span cLabel class="fw-bold">Search Question Library: </span>
            <app-select-search [options]="optionList" [selectedValue]="initQuestionGroupLibraryId()" (onChangeValue)="handleQuestionGroupLibraryChange($event)"
                placeholder="Select question group library..."></app-select-search>
        </div>
        <form cForm [formGroup]="createQuestionGroupForm" (ngSubmit)="onSubmitCreateQuestionGroup()">
            <div class="mb-2">
                <label for="priority" cLabel class="me-2">Priority: <span class="text-danger">(*)</span></label>
                <input formControlName="priority" type="number" class="me-2 number-control" min="1" max="255">
                @if (priorityCreateQuestionGroupForm?.invalid && (priorityCreateQuestionGroupForm?.dirty ||
                priorityCreateQuestionGroupForm?.touched)) {
                <div class="text-danger">
                    @if (priorityCreateQuestionGroupForm?.hasError('min') ||
                    priorityCreateQuestionGroupForm?.hasError('max')) {
                    <div>Priority must be between 1 and 255.</div>
                    }
                </div>
                }
            </div>
            <div class="row">

                <div class="col-6">
                    <label for="nameEN" cLabel>Name EN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="nameEN"
                        placeholder="Enter question group name in English">
                    @if (nameENCreateQuestionGroupForm?.invalid && (nameENCreateQuestionGroupForm?.dirty ||
                    nameENCreateQuestionGroupForm?.touched)) {
                    <div class="text-danger">
                        @if (nameENCreateQuestionGroupForm?.hasError('required')) {
                        <div>Enter Name, please!</div>
                        }
                    </div>
                    }
                </div>
                <div class="col-6">
                    <label for="nameVN" cLabel>Name VN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="nameVN"
                        placeholder="Enter question group name in Vietnamese">
                    @if (nameVNCreateQuestionGroupForm?.invalid && (nameVNCreateQuestionGroupForm?.dirty ||
                    nameVNCreateQuestionGroupForm?.touched)) {
                    <div class="text-danger">
                        @if (nameVNCreateQuestionGroupForm?.hasError('required')) {
                        <div>Enter Name, please!</div>
                        }
                    </div>
                    }
                </div>
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="toggleCreateQuestionGroupModal()" cButton color="secondary">
            <svg [cIcon]="icons.cilExitToApp" width="22" class="text-white" title="Exit to app Icon"></svg>
        </button>
        <button cButton color="primary" (click)="onSubmitCreateQuestionGroup()"
            [disabled]="createQuestionGroupForm.invalid">
            <svg [cIcon]="icons.cilSave" width="22" class="text-white" title="save Icon"></svg>
        </button>
    </c-modal-footer>
</c-modal>

<!-- Update Question Group Modal -->
<c-modal id="visibleUpdateQuestionGroupModal" [visible]="visibleUpdateQuestionGroupModal()" size="lg" backdrop="static"
    (visibleChange)="handleUpdateQuestionGroupModalChange($event)">
    <c-modal-header class="bg-primary d-flex justify-content-between align-items-center">
        <Question cModalTitle class="text-white fw-bold">Update Question Group</Question>
        <button (click)="toggleUpdateQuestionGroupModal()" class="btn btn-sm btnClose">
            <svg [cIcon]="icons.cilX" width="22" class="text-white" title="Close Icon"></svg>
        </button>
    </c-modal-header>
    <c-modal-body>
        <form cForm [formGroup]="updateQuestionGroupForm" (ngSubmit)="onSubmitUpdateQuestionGroup()">
            <div class="mb-2">
                <label for="priority" cLabel class="me-2">Priority: <span class="text-danger">(*)</span></label>
                <input formControlName="priority" type="number" class="me-2 number-control" min="1" max="255">
                @if (priorityUpdateQuestionGroupForm?.invalid && (priorityUpdateQuestionGroupForm?.dirty ||
                priorityUpdateQuestionGroupForm?.touched)) {
                <div class="text-danger">
                    @if (priorityUpdateQuestionGroupForm?.hasError('min') ||
                    priorityUpdateQuestionGroupForm?.hasError('max')) {
                    <div>Priority must be between 1 and 255.</div>
                    }
                </div>
                }
            </div>
            <div class="row">

                <div class="col-12 col-md-6">
                    <label for="nameEN" cLabel>Name EN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="nameEN"
                        placeholder="Enter question group name in English">
                    @if (nameENUpdateQuestionGroupForm?.invalid && (nameENUpdateQuestionGroupForm?.dirty ||
                    nameENUpdateQuestionGroupForm?.touched)) {
                    <div class="text-danger">
                        @if (nameENUpdateQuestionGroupForm?.hasError('required')) {
                        <div>Enter Name, please!</div>
                        }
                    </div>
                    }
                </div>
                <div class="col-12 col-md-6">
                    <label for="nameVN" cLabel>Name VN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="nameVN"
                        placeholder="Enter question group name in Vietnamese">
                    @if (nameVNUpdateQuestionGroupForm?.invalid && (nameVNUpdateQuestionGroupForm?.dirty ||
                    nameVNUpdateQuestionGroupForm?.touched)) {
                    <div class="text-danger">
                        @if (nameVNUpdateQuestionGroupForm?.hasError('required')) {
                        <div>Enter Name, please!</div>
                        }
                    </div>
                    }
                </div>
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="toggleUpdateQuestionGroupModal()" cButton color="secondary">
            <svg [cIcon]="icons.cilExitToApp" width="22" class="text-white" title="Close Icon"></svg>
        </button>
        <button cButton color="primary" (click)="onSubmitUpdateQuestionGroup()"
            [disabled]="updateQuestionGroupForm.invalid">
            <svg [cIcon]="icons.cilSave" width="22" class="text-white" title="Save Icon"></svg>
        </button>
    </c-modal-footer>
</c-modal>

<!-- Delete Question Group Modal -->
<c-modal id="visibleDeleteQuestionGroupModal" [visible]="visibleDeleteQuestionGroupModal()"
    (visibleChange)="handleDeleteQuestionGroupModalChange($event)">
    <c-modal-header class="bg-danger d-flex justify-content-between align-items-center">
        <h5 cModalTitle class="text-white fw-bold">Delete Question Group</h5>
        <button (click)="toggleDeleteQuestionGroupModal()" class="btn btn-sm btnClose">
            <svg [cIcon]="icons.cilX" width="22" class="text-white" title="Close Icon"></svg>
        </button>
    </c-modal-header>
    <c-modal-body>
        <p>Are you sure you want to delete this question group?</p>
        @if(deleteQuestionGroupIndex() !== -1 && questionGroups[deleteQuestionGroupIndex()]) {
        <div class="alert alert-warning">
            <strong>Question Group:</strong> {{ questionGroups[deleteQuestionGroupIndex()].nameEN }} / {{
            questionGroups[deleteQuestionGroupIndex()].nameVN }}
        </div>
        }
    </c-modal-body>
    <c-modal-footer>
        <button (click)="toggleDeleteQuestionGroupModal()" cButton color="secondary">
            <svg [cIcon]="icons.cilExitToApp" width="22" class="text-white" title="Exit to app Icon"></svg>
        </button>
        <button cButton (click)="confirmDeleteQuestionGroup()" color="danger">
            <svg [cIcon]="icons.cilTrash" width="22" class="text-white" title="Trash Icon"></svg>
        </button>
    </c-modal-footer>
</c-modal>

<!-- Create Question Modal -->
<c-modal id="visibleCreateQuestionModal" [visible]="visibleCreateQuestionModal()" size="lg" backdrop="static"
    (visibleChange)="handleCreateQuestionModalChange($event)">
    <c-modal-header class="bg-success d-flex justify-content-between align-items-center">
        <h5 cModalTitle class="text-white fw-bold">Create Question</h5>
        <button (click)="toggleCreateQuestionModal()" class="btn btn-sm btnClose">
            <svg [cIcon]="icons.cilX" width="22" class="text-white" title="Close Icon"></svg>
        </button>
    </c-modal-header>
    <c-modal-body>
        <div class="mb-4">
            <span cLabel class="fw-bold">Search Question Library: </span>
            <app-tree-select [options]="treeOptionList" [selectedValue]="initQuestionLibraryId()" (onChangeValue)="handleQuestionLibraryChange($event)"
                placeholder="Select question group library..."></app-tree-select>
        </div>
        <form cForm [formGroup]="createQuestionForm" (ngSubmit)="onSubmitCreateQuestion()">
            <div class="row mb-2">
                <div class="col-4">
                    <label for="priority" cLabel class="me-2">Priority: <span class="text-danger">(*)</span></label>
                    <input formControlName="priority" type="number" cFormControl class="me-2" min="1" max="255">
                    @if (priorityCreateQuestionForm?.invalid && (priorityCreateQuestionForm?.dirty ||
                    priorityCreateQuestionForm?.touched)) {
                    <div class="text-danger">
                        @if (priorityCreateQuestionForm?.hasError('min') ||
                        priorityCreateQuestionForm?.hasError('max')) {
                        <div>Priority must be between 1 and 255.</div>
                        }
                    </div>
                    }
                </div>
                <div class="col-8">
                    <label cLabel class="me-2">Question type: <span class="text-danger">(*)</span></label>
                    <app-select-search [options]="questionTypeList" [selectedValue]="initQuestionTypeId()"
                        (onChangeValue)="onchangeQuestionType($event)"
                        placeholder="Select question type..."></app-select-search>
                </div>
            </div>
            <div class="row">

                <div class="col-6">
                    <label for="nameEN" cLabel>Name EN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="nameEN"
                        placeholder="Enter question group name in English">
                    @if (nameENCreateQuestionForm?.invalid && (nameENCreateQuestionForm?.dirty ||
                    nameENCreateQuestionForm?.touched)) {
                    <div class="text-danger">
                        @if (nameENCreateQuestionForm?.hasError('required')) {
                        <div>Enter Name, please!</div>
                        }
                    </div>
                    }
                </div>
                <div class="col-6">
                    <label for="nameVN" cLabel>Name VN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="nameVN"
                        placeholder="Enter question group name in Vietnamese">
                    @if (nameVNCreateQuestionForm?.invalid && (nameVNCreateQuestionForm?.dirty ||
                    nameVNCreateQuestionForm?.touched)) {
                    <div class="text-danger">
                        @if (nameVNCreateQuestionForm?.hasError('required')) {
                        <div>Enter Name, please!</div>
                        }
                    </div>
                    }
                </div>
            </div>
        </form>
        @if(showPredefinedAnswerTable()) {

        <div class="d-flex justify-content-between align-items-center title mt-4">
            <span>Predefined Answers</span>
            <div class="d-flex justify-content-end">
                <button cButton type="button" class="btn-success text-white d-flex align-items-center"
                    (click)="showCreatePredefinedAnswerForm()" [disabled]="visibleCreatePredefinedAnswerForm()">
                    <svg [cIcon]="icons.cilPlus" width="22" class="text-white" title="Plus Icon"></svg>
                </button>
            </div>
        </div>
        <table [hover]="true" [responsive]="true" cTable>
            <thead>
                <tr>
                    <th>No.</th>
                    <th>NameEN</th>
                    <th>NameVN</th>
                    <th>Priority</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <!-- Predefined Answer Form Row -->
                @if(visibleCreatePredefinedAnswerForm()) {
                <tr [formGroup]="createPredefinedAnswerForm" class="adding">
                    <td class="new-id">New</td>
                    <td>
                        <input type="text" formControlName="nameEN" class="form-control"
                            placeholder="Enter predefined answer name in English">
                        @if (nameENCreatePredefinedAnswerForm?.invalid && (nameENCreatePredefinedAnswerForm?.dirty ||
                        nameENCreatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (nameENCreatePredefinedAnswerForm?.hasError('required')) {
                            <div>Enter Name, please!</div>
                            }
                        </div>
                        }
                    </td>
                    <td>
                        <input type="text" formControlName="nameVN" class="form-control"
                            placeholder="Enter predefined answer name in Vietnamese">
                        @if (nameVNCreatePredefinedAnswerForm?.invalid && (nameVNCreatePredefinedAnswerForm?.dirty ||
                        nameVNCreatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (nameVNCreatePredefinedAnswerForm?.hasError('required')) {
                            <div>Enter Name, please!</div>
                            }
                        </div>
                        }
                    </td>
                    <td>
                        <input type="number" formControlName="priority" class="form-control number-control" min="1"
                            max="255">
                        @if (priorityCreatePredefinedAnswerForm?.invalid && (priorityCreatePredefinedAnswerForm?.dirty
                        ||
                        priorityCreatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (priorityCreatePredefinedAnswerForm?.hasError('min') ||
                            priorityCreatePredefinedAnswerForm?.hasError('max')) {
                            <div>Priority must be between 1 and 255.</div>
                            }
                        </div>
                        }
                    </td>
                    <td class="d-flex justify-content-end">
                        <button cButton type="button" (click)="onSubmitCreatePredefinedAnswer()"
                            class="btn btn-primary me-2" [disabled]="createPredefinedAnswerForm.invalid">
                            <svg [cIcon]="icons.cilSave" width="20" class="text-white" title="Save Icon"></svg>
                        </button>
                        <button cButton type="button" (click)="hideCreatePredefinedAnswerForm()" class="btn btn-danger">
                            <svg [cIcon]="icons.cilX" width="20" class="text-white" title="Close Icon"></svg>
                        </button>
                    </td>

                </tr>
                }

                @for (item of predefinedAnswerList; track $index; let i = $index) {
                @if(updatePredefinedAnswerIndex() !== -1 && updatePredefinedAnswerIndex() === i) {
                <tr [formGroup]="updatePredefinedAnswerForm" class="editing">
                    <td>{{ i + 1 }}</td>
                    <td>
                        <input type="text" formControlName="nameEN" class="form-control"
                            placeholder="Enter predefined answer name in English">
                        @if (nameENUpdatePredefinedAnswerForm?.invalid && (nameENUpdatePredefinedAnswerForm?.dirty ||
                        nameENUpdatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (nameENUpdatePredefinedAnswerForm?.hasError('required')) {
                            <div>Enter Name, please!</div>
                            }
                        </div>
                        }
                    </td>
                    <td>
                        <input type="text" formControlName="nameVN" class="form-control"
                            placeholder="Enter predefined answer name in Vietnamese">
                        @if (nameVNUpdatePredefinedAnswerForm?.invalid && (nameVNUpdatePredefinedAnswerForm?.dirty ||
                        nameVNUpdatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (nameVNUpdatePredefinedAnswerForm?.hasError('required')) {
                            <div>Enter Name, please!</div>
                            }
                        </div>
                        }
                    </td>
                    <td>
                        <input type="number" formControlName="priority" class="form-control number-control" min="1"
                            max="255">
                        @if (priorityUpdatePredefinedAnswerForm?.invalid && (priorityUpdatePredefinedAnswerForm?.dirty
                        ||
                        priorityUpdatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (priorityUpdatePredefinedAnswerForm?.hasError('min') ||
                            priorityUpdatePredefinedAnswerForm?.hasError('max')) {
                            <div>Priority must be between 1 and 255.</div>
                            }
                        </div>
                        }
                    </td>
                    <td class="d-flex justify-content-end">
                        <button cButton type="button" (click)="onSubmitUpdatePredefinedAnswer()"
                            class="btn btn-primary me-2" [disabled]="updatePredefinedAnswerForm.invalid">
                            <svg [cIcon]="icons.cilSave" width="20" class="text-white" title="Save Icon"></svg>
                        </button>
                        <button cButton type="button" (click)="updatePredefinedAnswer(-1)" class="btn btn-danger">
                            <svg [cIcon]="icons.cilX" width="20" class="text-white" title="Close Icon"></svg>
                        </button>
                    </td>

                </tr>
                }@else {
                <tr>
                    <td>{{ i + 1 }}</td>
                    <td>{{ item.nameEN }}</td>
                    <td>{{ item.nameVN }}</td>
                    <td>{{ item.priority }}</td>
                    <td class="d-flex justify-content-end">
                        <button cButton type="button" (click)="updatePredefinedAnswer(i)" class="btn btn-primary me-2">
                            <svg [cIcon]="icons.cilPen" width="20" class="text-white" title="Edit Icon"></svg>
                        </button>
                        <button cButton type="button" (click)="deletePredefinedAnswer(i)" class="btn btn-danger">
                            <svg [cIcon]="icons.cilTrash" width="20" class="text-white" title="Delete Icon"></svg>
                        </button>
                    </td>
                </tr>
                }

                }
            </tbody>
        </table>
        @if(predefinedAnswerList.length === 0) {
        <div class="py-4">
            <p class="text-center opacity-50">No Predefined Answers available. Click Button Add to get started.</p>
        </div>
        }
        }
    </c-modal-body>
    <c-modal-footer>
        <button (click)="toggleCreateQuestionModal()" cButton color="secondary">
            <svg [cIcon]="icons.cilExitToApp" width="22" class="text-white" title="Exit to app Icon"></svg>
        </button>
        <button cButton color="primary" [disabled]="createQuestionForm.invalid" (click)="onSubmitCreateQuestion()">
            <svg [cIcon]="icons.cilSave" width="22" class="text-white" title="Save Icon"></svg>
        </button>
    </c-modal-footer>
</c-modal>

<!-- Update Question Modal -->
<c-modal id="visibleUpdateQuestionModal" [visible]="visibleUpdateQuestionModal()" size="lg" backdrop="static"
    (visibleChange)="handleUpdateQuestionModalChange($event)">
    <c-modal-header class="bg-primary d-flex justify-content-between align-items-center">
        <h5 cModalTitle class="text-white fw-bold">Update Question</h5>
        <button (click)="toggleUpdateQuestionModal()" class="btn btn-sm btnClose">
            <svg [cIcon]="icons.cilX" width="22" class="text-white" title="Close Icon"></svg>
        </button>
    </c-modal-header>
    <c-modal-body>
        <form cForm [formGroup]="updateQuestionForm" (ngSubmit)="onSubmitUpdateQuestion()">
            <div class="row mb-2">
                <div class="col-4">
                    <label for="priority" cLabel class="me-2">Priority: <span class="text-danger">(*)</span></label>
                    <input formControlName="priority" type="number" cFormControl min="1" max="255">
                    @if (priorityUpdateQuestionForm?.invalid && (priorityUpdateQuestionForm?.dirty ||
                    priorityUpdateQuestionForm?.touched)) {
                    <div class="text-danger">
                        @if (priorityUpdateQuestionForm?.hasError('min') ||
                        priorityUpdateQuestionForm?.hasError('max')) {
                        <div>Priority must be between 1 and 255.</div>
                        }
                    </div>
                    }
                </div>

                <div class="col-8">
                    <label cLabel class="me-2">Question type: <span class="text-danger">(*)</span></label>
                    <app-select-search [options]="questionTypeList" [selectedValue]="initQuestionTypeId()"
                        (onChangeValue)="onchangeQuestionType($event)"
                        placeholder="Select question type..."></app-select-search>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <label for="nameEN" cLabel>Name EN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="nameEN"
                        placeholder="Enter question name in English">
                    @if (nameENUpdateQuestionForm?.invalid && (nameENUpdateQuestionForm?.dirty ||
                    nameENUpdateQuestionForm?.touched)) {
                    <div class="text-danger">
                        @if (nameENUpdateQuestionForm?.hasError('required')) {
                        <div>Enter Name, please!</div>
                        }
                    </div>
                    }
                </div>
                <div class="col-6">
                    <label for="nameVN" cLabel>Name VN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="nameVN"
                        placeholder="Enter question name in Vietnamese">
                    @if (nameVNUpdateQuestionForm?.invalid && (nameVNUpdateQuestionForm?.dirty ||
                    nameVNUpdateQuestionForm?.touched)) {
                    <div class="text-danger">
                        @if (nameVNUpdateQuestionForm?.hasError('required')) {
                        <div>Enter Name, please!</div>
                        }
                    </div>
                    }
                </div>
            </div>
        </form>
        @if(showPredefinedAnswerTable()) {

        <div class="d-flex justify-content-between align-items-center title mt-4">
            <span>Predefined Answers</span>
            <div class="d-flex justify-content-end">
                <button cButton type="button" class="btn-success text-white d-flex align-items-center"
                    (click)="showCreatePredefinedAnswerForm()" [disabled]="visibleCreatePredefinedAnswerForm()">
                    <svg [cIcon]="icons.cilPlus" width="22" class="text-white" title="Plus Icon"></svg>
                </button>
            </div>
        </div>
        <table [hover]="true" [responsive]="true" cTable>
            <thead>
                <tr>
                    <th>No.</th>
                    <th>NameEN</th>
                    <th>NameVN</th>
                    <th>Priority</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <!-- Predefined Answer Form Row -->
                @if(visibleCreatePredefinedAnswerForm()) {
                <tr [formGroup]="createPredefinedAnswerForm" class="adding">
                    <td class="new-id">New</td>
                    <td>
                        <input type="text" formControlName="nameEN" class="form-control"
                            placeholder="Enter predefined answer name in English">
                        @if (nameENCreatePredefinedAnswerForm?.invalid && (nameENCreatePredefinedAnswerForm?.dirty ||
                        nameENCreatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (nameENCreatePredefinedAnswerForm?.hasError('required')) {
                            <div>Enter Name, please!</div>
                            }
                        </div>
                        }
                    </td>
                    <td>
                        <input type="text" formControlName="nameVN" class="form-control"
                            placeholder="Enter predefined answer name in Vietnamese">
                        @if (nameVNCreatePredefinedAnswerForm?.invalid && (nameVNCreatePredefinedAnswerForm?.dirty ||
                        nameVNCreatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (nameVNCreatePredefinedAnswerForm?.hasError('required')) {
                            <div>Enter Name, please!</div>
                            }
                        </div>
                        }
                    </td>
                    <td>
                        <input type="number" formControlName="priority" class="form-control number-control" min="1"
                            max="255">
                        @if (priorityCreatePredefinedAnswerForm?.invalid && (priorityCreatePredefinedAnswerForm?.dirty
                        ||
                        priorityCreatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (priorityCreatePredefinedAnswerForm?.hasError('min') ||
                            priorityCreatePredefinedAnswerForm?.hasError('max')) {
                            <div>Priority must be between 1 and 255.</div>
                            }
                        </div>
                        }
                    </td>
                    <td class="d-flex justify-content-end">
                        <button cButton type="button" (click)="onSubmitCreatePredefinedAnswer()"
                            class="btn btn-primary me-2" [disabled]="createPredefinedAnswerForm.invalid">
                            <svg [cIcon]="icons.cilSave" width="20" class="text-white" title="Save Icon"></svg>
                        </button>
                        <button cButton type="button" (click)="hideCreatePredefinedAnswerForm()" class="btn btn-danger">
                            <svg [cIcon]="icons.cilX" width="20" class="text-white" title="Close Icon"></svg>
                        </button>
                    </td>

                </tr>
                }

                @for (item of predefinedAnswerList; track $index; let i = $index) {
                @if(updatePredefinedAnswerIndex() !== -1 && updatePredefinedAnswerIndex() === i) {
                <tr [formGroup]="updatePredefinedAnswerForm" class="editing">
                    <td>{{ i + 1 }}</td>
                    <td>
                        <input type="text" formControlName="nameEN" class="form-control"
                            placeholder="Enter predefined answer name in English">
                        @if (nameENUpdatePredefinedAnswerForm?.invalid && (nameENUpdatePredefinedAnswerForm?.dirty ||
                        nameENUpdatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (nameENUpdatePredefinedAnswerForm?.hasError('required')) {
                            <div>Enter Name, please!</div>
                            }
                        </div>
                        }
                    </td>
                    <td>
                        <input type="text" formControlName="nameVN" class="form-control"
                            placeholder="Enter predefined answer name in Vietnamese">
                        @if (nameVNUpdatePredefinedAnswerForm?.invalid && (nameVNUpdatePredefinedAnswerForm?.dirty ||
                        nameVNUpdatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (nameVNUpdatePredefinedAnswerForm?.hasError('required')) {
                            <div>Enter Name, please!</div>
                            }
                        </div>
                        }
                    </td>
                    <td>
                        <input type="number" formControlName="priority" class="form-control number-control" min="1"
                            max="255">
                        @if (priorityUpdatePredefinedAnswerForm?.invalid && (priorityUpdatePredefinedAnswerForm?.dirty
                        ||
                        priorityUpdatePredefinedAnswerForm?.touched)) {
                        <div class="text-danger">
                            @if (priorityUpdatePredefinedAnswerForm?.hasError('min') ||
                            priorityUpdatePredefinedAnswerForm?.hasError('max')) {
                            <div>Priority must be between 1 and 255.</div>
                            }
                        </div>
                        }
                    </td>
                    <td class="d-flex justify-content-end">
                        <button cButton type="button" (click)="onSubmitUpdatePredefinedAnswer()"
                            class="btn btn-primary me-2" [disabled]="updatePredefinedAnswerForm.invalid">
                            <svg [cIcon]="icons.cilSave" width="20" class="text-white" title="Save Icon"></svg>
                        </button>
                        <button cButton type="button" (click)="updatePredefinedAnswer(-1)" class="btn btn-danger">
                            <svg [cIcon]="icons.cilX" width="20" class="text-white" title="Close Icon"></svg>
                        </button>
                    </td>

                </tr>
                }@else {
                <tr>
                    <td>{{ i + 1 }}</td>
                    <td>{{ item.nameEN }}</td>
                    <td>{{ item.nameVN }}</td>
                    <td>{{ item.priority }}</td>
                    <td class="d-flex justify-content-end">
                        <button cButton type="button" (click)="updatePredefinedAnswer(i)" class="btn btn-primary me-2">
                            <svg [cIcon]="icons.cilPen" width="20" class="text-white" title="Edit Icon"></svg>
                        </button>
                        <button cButton type="button" (click)="deletePredefinedAnswer(i)" class="btn btn-danger">
                            <svg [cIcon]="icons.cilTrash" width="20" class="text-white" title="Delete Icon"></svg>
                        </button>
                    </td>
                </tr>
                }

                }
            </tbody>
        </table>
        @if(predefinedAnswerList.length === 0) {
        <div class="py-4">
            <p class="text-center opacity-50">No Predefined Answers available. Click Button Add to get started.</p>
        </div>
        }
        }
    </c-modal-body>
    <c-modal-footer>
        <button (click)="toggleUpdateQuestionModal()" cButton color="secondary">
            <svg [cIcon]="icons.cilExitToApp" width="22" class="text-white" title="Close Icon"></svg>
        </button>
        <button cButton color="primary" [disabled]="updateQuestionForm.invalid" (click)="onSubmitUpdateQuestion()">
            <svg [cIcon]="icons.cilSave" width="22" class="text-white" title="Save Icon"></svg>
        </button>
    </c-modal-footer>
</c-modal>

<!-- Delete Question Modal -->
<c-modal id="visibleDeleteQuestionModal" [visible]="visibleDeleteQuestionModal()"
    (visibleChange)="handleDeleteQuestionModalChange($event)">
    <c-modal-header class="bg-danger d-flex justify-content-between align-items-center">
        <h5 cModalTitle class="text-white fw-bold">Delete Question</h5>
        <button (click)="toggleDeleteQuestionModal()" class="btn btn-sm btnClose">
            <svg [cIcon]="icons.cilX" width="22" class="text-white" title="Close Icon"></svg>
        </button>
    </c-modal-header>
    <c-modal-body>
        <p>Are you sure you want to delete this question?</p>
        @if(deleteQuestionIndex() !== -1 && questions[deleteQuestionIndex()]) {
        <div class="alert alert-warning">
            <strong>Question:</strong> {{ questions[deleteQuestionIndex()].nameEN }} / {{
            questions[deleteQuestionIndex()].nameVN }}
        </div>
        }
        <p class="text-muted">This action cannot be undone.</p>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="toggleDeleteQuestionModal()" cButton color="secondary">
            <svg [cIcon]="icons.cilExitToApp" width="22" class="text-white" title="Exit to app Icon"></svg>
        </button>
        <button cButton (click)="confirmDeleteQuestion()" color="danger">
            <svg [cIcon]="icons.cilTrash" width="22" class="text-white" title="Trash Icon"></svg>
        </button>
    </c-modal-footer>
</c-modal>