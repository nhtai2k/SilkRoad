<div class="d-flex justify-content-between align-items-center customTitle mt-4">
    <span>2. Participant Information Configurations</span>
    <div class="d-flex justify-content-end">
        <button cButton type="button" (click)="toggleCreateModal()"
            [disabled]="disableForm"
            class="btn-success text-white d-flex align-items-center">
            <svg [cIcon]="icons.cilPlus" width="22" class="text-white" title="Plus Icon"></svg>
        </button>
    </div>
</div>
@if(initData.length > 0) {
<table cTable>
    <thead>
        <tr>
            <th scope="col">No.</th>
            <th scope="col">Field Name EN</th>
            <th scope="col">Field Name VN</th>
            <th scope="col">Is Required</th>
            <th scope="col">Priority</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @for(item of initData; track $index; let i = $index) {
        <tr>
            <td>{{ i + 1 }}</td>
            <td>{{ item.fieldNameEN }}</td>
            <td>{{ item.fieldNameVN }}</td>
            <td>{{ item.isRequired }}</td>
            <td>{{ item.priority }}</td>
            <td class="text-end">
                <button cButton type="button" (click)="update(item?.id)" class="btn-primary text-white me-2" [disabled]="disableForm">
                    <svg [cIcon]="icons.cilPen" width="20" class="text-white" title="Edit Icon"></svg>
                </button>
                <button cButton type="button" (click)="delete(item?.id)" class="btn-danger text-white" [disabled]="disableForm">
                    <svg [cIcon]="icons.cilTrash" width="20" class="text-white" title="Trash Icon"></svg>
                </button>
            </td>
        </tr>
        }
    </tbody>
</table>
} @else {
<div class="pt-4">
    <p class="text-center opacity-50"> No question group available. Click Button Add to get started.</p>
</div>
}


<!-- Create Question Group Modal -->
<c-modal id="visibleCreateModal" [visible]="visibleCreateModal()" size="lg" backdrop="static"
    (visibleChange)="handleCreateModalChange($event)">
    <c-modal-header class="bg-success d-flex justify-content-between align-items-center">
        <h5 cModalTitle class="fw-bold text-white">Create Field</h5>
        <button (click)="toggleCreateModal()" class="btn btn-sm btnClose">
            <svg [cIcon]="icons.cilX" width="22" class="text-white" title="Close Icon"></svg>
        </button>
    </c-modal-header>
    <c-modal-body>
        <form cForm [formGroup]="createForm">
            <c-form-check class="mb-2">
                <label cFormCheckLabel for="isRequired">Is required</label>
                <input cFormCheckInput id="isRequired" type="checkbox" formControlName="isRequired" />
            </c-form-check>
                <div class="mb-2">
                <label for="priority" cLabel class="me-2">Priority: <span class="text-danger">(*)</span></label>
                <input formControlName="priority" type="number" class="me-2 number-control" min="1" max="255">
                @if (priorityCreateForm?.invalid && (priorityCreateForm?.dirty ||
                priorityCreateForm?.touched)) {
                <div class="text-danger">
                    @if (priorityCreateForm?.hasError('min') ||
                    priorityCreateForm?.hasError('max')) {
                    <div>Priority must be between 1 and 255.</div>
                    }
                </div>
                }
            </div>
             <div class="row mb-2">
                <div class="col-12 col-md-6">
                    <label for="fieldNameEN" cLabel>Field name EN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="fieldNameEN"
                        placeholder="Enter field name in English">
                    @if(fieldNameENCreateForm?.invalid && (fieldNameENCreateForm?.dirty ||
                    fieldNameENCreateForm?.touched)) {
                    <div class="text-danger">
                        @if (fieldNameENCreateForm?.hasError('required')) {
                        <div>Enter Field name, please!</div>
                        }
                    </div>
                    }
                </div>
                <div class="col-12 col-md-6">
                    <label for="fieldNameVN" cLabel>Field name VN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="fieldNameVN"
                        placeholder="Enter field name in Vietnamese">
                    @if(fieldNameVNCreateForm?.invalid && (fieldNameVNCreateForm?.dirty ||
                    fieldNameVNCreateForm?.touched)) {
                    <div class="text-danger">
                        @if (fieldNameVNCreateForm?.hasError('required')) {
                        <div>Enter Field name, please!</div>
                        }
                    </div>
                    }
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-12 col-md-6">
                    <label for="typeId" cLabel>Select Type: <span class="text-danger">(*)</span></label>
                     <select cFormControl formControlName="typeId" cSelect>
                        <option value="-1">--Select type--</option>
                        @for (item of fieldTypeOptions; track item.key; let i = $index) {
                        <option [value]="item.value">{{item.key}}</option>
                        }
                    </select>
                </div>
                <div class="col-6 col-md-3">
                    <label for="minLength" cLabel>Min Length: <span class="text-danger">(*)</span></label>
                    <input type="number" cFormControl formControlName="minLength"
                        placeholder="Minimum length">
                    @if(minLengthCreateForm?.invalid && (minLengthCreateForm?.dirty ||
                    minLengthCreateForm?.touched)) {
                    <div class="text-danger">
                        @if (minLengthCreateForm?.hasError('required')) {
                        <div>Enter Field name, please!</div>
                        }
                    </div>
                    }
                </div>
                <div class="col-6 col-md-3">
                    <label for="maxLength" cLabel>Max Length: <span class="text-danger">(*)</span></label>
                    <input type="number" cFormControl formControlName="maxLength"
                        placeholder="Maximum length">
                    @if(maxLengthCreateForm?.invalid && (maxLengthCreateForm?.dirty ||
                    maxLengthCreateForm?.touched)) {
                    <div class="text-danger">
                        @if (maxLengthCreateForm?.hasError('required')) {
                        <div>Enter Field name, please!</div>
                        }
                    </div>
                    }
                </div>
            </div>
           
            <div class="row mb-2">
                <div class="col-12 col-md-6">
                    <label for="placeholderEN" cLabel>Placeholder EN:</label>
                    <input type="text" cFormControl formControlName="placeholderEN"
                        placeholder="Enter field placeholder in English">
                    @if(placeholderENCreateForm?.invalid && (placeholderENCreateForm?.dirty ||
                    placeholderENCreateForm?.touched)) {
                    <div class="text-danger">
                        @if (placeholderENCreateForm?.hasError('maxlength')) {
                        <div>Placeholder must be at most 255 characters long.</div>
                        }
                    </div>
                    }
                </div>
                <div class="col-12 col-md-6">
                    <label for="placeholderVN" cLabel>Placeholder VN:</label>
                    <input type="text" cFormControl formControlName="placeholderVN"
                        placeholder="Enter field placeholder in Vietnamese">
                    @if(placeholderVNCreateForm?.invalid && (placeholderVNCreateForm?.dirty ||
                    placeholderVNCreateForm?.touched)) {
                    <div class="text-danger">
                        @if (placeholderVNCreateForm?.hasError('maxlength')) {
                        <div>Placeholder must be at most 255 characters long.</div>
                        }
                    </div>
                    }
                </div>
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="toggleCreateModal()" cButton color="secondary">
            <svg [cIcon]="icons.cilExitToApp" width="22" class="text-white" title="Exit to app Icon"></svg>
        </button>
        <button cButton color="primary" (click)="onCreateFormSubmit()" [disabled]="createForm.invalid">
            <svg [cIcon]="icons.cilSave" width="22" class="text-white" title="save Icon"></svg>
        </button>
    </c-modal-footer>
</c-modal>

<!-- Update Question Group Modal -->
<c-modal id="visibleUpdateModal" [visible]="visibleUpdateModal()" size="lg" backdrop="static"
    (visibleChange)="handleUpdateModalChange($event)">
    <c-modal-header class="bg-primary d-flex justify-content-between align-items-center">
        <Question cModalTitle class="text-white fw-bold">Update Field</Question>
        <button (click)="toggleUpdateModal()" class="btn btn-sm btnClose">
            <svg [cIcon]="icons.cilX" width="22" class="text-white" title="Close Icon"></svg>
        </button>
    </c-modal-header>
    <c-modal-body>
                <form cForm [formGroup]="updateForm">
            <c-form-check class="mb-2">
                <label cFormCheckLabel for="isRequired1">Is required</label>
                <input cFormCheckInput id="isRequired1" type="checkbox" formControlName="isRequired" />
            </c-form-check>
                <div class="mb-2">
                <label for="priority" cLabel class="me-2">Priority: <span class="text-danger">(*)</span></label>
                <input formControlName="priority" type="number" class="me-2 number-control" min="1" max="255">
                @if (priorityUpdateForm?.invalid && (priorityUpdateForm?.dirty ||
                priorityUpdateForm?.touched)) {
                <div class="text-danger">
                    @if (priorityUpdateForm?.hasError('min') ||
                    priorityUpdateForm?.hasError('max')) {
                    <div>Priority must be between 1 and 255.</div>
                    }
                </div>
                }
            </div>
             <div class="row mb-2">
                <div class="col-12 col-md-6">
                    <label for="fieldNameEN" cLabel>Field name EN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="fieldNameEN"
                        placeholder="Enter field name in English">
                    @if(fieldNameENUpdateForm?.invalid && (fieldNameENUpdateForm?.dirty ||
                    fieldNameENUpdateForm?.touched)) {
                    <div class="text-danger">
                        @if (fieldNameENUpdateForm?.hasError('required')) {
                        <div>Enter Field name, please!</div>
                        }
                    </div>
                    }
                </div>
                <div class="col-12 col-md-6">
                    <label for="fieldNameVN" cLabel>Field name VN: <span class="text-danger">(*)</span></label>
                    <input type="text" cFormControl formControlName="fieldNameVN"
                        placeholder="Enter field name in Vietnamese">
                    @if(fieldNameVNUpdateForm?.invalid && (fieldNameVNUpdateForm?.dirty ||
                    fieldNameVNUpdateForm?.touched)) {
                    <div class="text-danger">
                        @if (fieldNameVNUpdateForm?.hasError('required')) {
                        <div>Enter Field name, please!</div>
                        }
                    </div>
                    }
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-12 col-md-6">
                    <label for="typeId" cLabel>Select Type: <span class="text-danger">(*)</span></label>
                     <select cFormControl formControlName="typeId" cSelect>
                        <option value="-1">--Select type--</option>
                        @for (item of fieldTypeOptions; track item.key; let i = $index) {
                        <option [value]="item.value">{{item.key}}</option>
                        }
                    </select>
                </div>
                <div class="col-6 col-md-3">
                    <label for="minLength" cLabel>Min Length: <span class="text-danger">(*)</span></label>
                    <input type="number" cFormControl formControlName="minLength"
                        placeholder="Minimum length">
                    @if(minLengthUpdateForm?.invalid && (minLengthUpdateForm?.dirty ||
                    minLengthUpdateForm?.touched)) {
                    <div class="text-danger">
                        @if (minLengthUpdateForm?.hasError('required')) {
                        <div>Enter Field name, please!</div>
                        }
                    </div>
                    }
                </div>
                <div class="col-6 col-md-3">
                    <label for="maxLength" cLabel>Max Length: <span class="text-danger">(*)</span></label>
                    <input type="number" cFormControl formControlName="maxLength"
                        placeholder="Maximum length">
                    @if(maxLengthUpdateForm?.invalid && (maxLengthUpdateForm?.dirty ||
                    maxLengthUpdateForm?.touched)) {
                    <div class="text-danger">
                        @if (maxLengthUpdateForm?.hasError('required')) {
                        <div>Enter Field name, please!</div>
                        }
                    </div>
                    }
                </div>
            </div>
           
            <div class="row mb-2">
                <div class="col-12 col-md-6">
                    <label for="placeholderEN" cLabel>Placeholder EN:</label>
                    <input type="text" cFormControl formControlName="placeholderEN"
                        placeholder="Enter field placeholder in English">
                    @if(placeholderENUpdateForm?.invalid && (placeholderENUpdateForm?.dirty ||
                    placeholderENUpdateForm?.touched)) {
                    <div class="text-danger">
                        @if (placeholderENUpdateForm?.hasError('maxlength')) {
                        <div>Placeholder must be at most 255 characters long.</div>
                        }
                    </div>
                    }
                </div>
                <div class="col-12 col-md-6">
                    <label for="placeholderVN" cLabel>Placeholder VN:</label>
                    <input type="text" cFormControl formControlName="placeholderVN"
                        placeholder="Enter field placeholder in Vietnamese">
                    @if(placeholderVNUpdateForm?.invalid && (placeholderVNUpdateForm?.dirty ||
                    placeholderVNUpdateForm?.touched)) {
                    <div class="text-danger">
                        @if (placeholderVNUpdateForm?.hasError('maxlength')) {
                        <div>Placeholder must be at most 255 characters long.</div>
                        }
                    </div>
                    }
                </div>
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="toggleUpdateModal()" cButton color="secondary">
            <svg [cIcon]="icons.cilExitToApp" width="22" class="text-white" title="Close Icon"></svg>
        </button>
        <button cButton color="primary" [disabled]="updateForm.invalid" (click)="onUpdateFormSubmit()">
            <svg [cIcon]="icons.cilSave" width="22" class="text-white" title="Save Icon"></svg>
        </button>
    </c-modal-footer>
</c-modal>

<!-- Delete Question Group Modal -->
<c-modal id="visibleDeleteModal" [visible]="visibleDeleteModal()" (visibleChange)="handleDeleteModalChange($event)">
    <c-modal-header class="bg-danger d-flex justify-content-between align-items-center">
        <h5 cModalTitle class="text-white fw-bold">Delete Field</h5>
        <button (click)="toggleDeleteModal()" class="btn btn-sm btnClose">
            <svg [cIcon]="icons.cilX" width="22" class="text-white" title="Close Icon"></svg>
        </button>
    </c-modal-header>
    <c-modal-body>
        <p>Are you sure you want to delete this field?</p>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="toggleDeleteModal()" cButton color="secondary">
            <svg [cIcon]="icons.cilExitToApp" width="22" class="text-white" title="Exit to app Icon"></svg>
        </button>
        <button cButton color="danger" (click)="onConfirmDelete()" >
            <svg [cIcon]="icons.cilTrash" width="22" class="text-white" title="Trash Icon"></svg>
        </button>
    </c-modal-footer>
</c-modal>