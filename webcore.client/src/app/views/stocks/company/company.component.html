<h3 class="fw-bold">Company List</h3>
<c-accordion class="mb-4">
  <c-accordion-item #item0="cAccordionItem" [visible]="true">
    <ng-template cTemplateId="accordionHeaderTemplate">
      <button (click)="item0.toggleItem()" [collapsed]="!item0.visible" cAccordionButton>
        Filter:
      </button>
    </ng-template>
    <ng-template cTemplateId="accordionBodyTemplate">
      <div class="accordion-body">
        <div class="row">
          <div class="col-8 col-md-6">
              <app-select-search class="w-100" [options]="industryList" (onChangeValue)="onChangeIndustry($event)" [placeholder]="'All Industry'"></app-select-search>
          </div>
          <div class="col-4 col-md-6">
            <div class="d-flex justify-content-end mb-2">
              <button (click)="toggleLiveTrashModal()" class="btn btn-warning me-2">
                <svg [cIcon]="icons.cilTrash" width="25" class="text-white" title="Trash Icon"></svg>
              </button>
              <button (click)="toggleLiveCreateModel()" class="btn btn-success">
                <svg [cIcon]="icons.cilPlus" width="25" class="text-white" title="Plus Icon"></svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </c-accordion-item>
</c-accordion>

<app-data-table [data]="pageInformation" (changePageIndex)="onPageIndexChange($event)"
  (changePageSize)="onPageSizeChange($event)">
  <thead class="text-nowrap text-truncate">
    <tr>
      <th scope="col">STT</th>
      <th scope="col">Name</th>
      <th scope="col">Symbol</th>
      <th scope="col" class="d-none d-md-table-cell">isActive</th>
      <th scope="col" class="d-none d-md-table-cell">Created By</th>
      <th scope="col" class="d-none d-md-table-cell">Modified By</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    @for (item of data.items; track item.id; let i = $index) {
    <tr>
      <td>{{ i+1 }}</td>
      <td>{{ item.name }}</td>
      <td>{{ item.symbol }}</td>
      <td class="d-none d-md-table-cell">{{ item.isActive }}</td>
      <td class="d-none d-md-table-cell">{{ item.createdBy }}</td>
      <td class="d-none d-md-table-cell">{{ item.modifiedBy }}</td>
      <td>
        <div class="d-flex justify-content-end">
          <button (click)="fetchNewData(item.symbol)" class="btn btn-success me-2" [disabled]="!fetchNewDataAllowed">
            <svg [cIcon]="icons.cilLoopCircular" width="25" class="text-white" title="Edit Icon"></svg>
          </button>
          <button (click)="updateData(item.id)" class="btn btn-primary me-2">
            <svg [cIcon]="icons.cilPen" width="25" class="text-white" title="Edit Icon"></svg>
          </button>
          <button (click)="softDeleteData(item.id)" class="btn btn-danger">
            <svg [cIcon]="icons.cilTrash" width="25" class="text-white" title="Delete Icon"></svg>
          </button>
        </div>
      </td>
    </tr>
    }
  </tbody>
</app-data-table>

<!-- Create Modal -->
<c-modal backdrop="static" [visible]="visibleCreateModal" (visibleChange)="handleLiveCreateModelChange($event)"
  id="verticallyCenteredCreateModal" size="lg">
  <c-modal-header>
    <h5 cModalTitle>Create Company</h5>
    <button (click)="toggleLiveCreateModel()" cButtonClose></button>
  </c-modal-header>
  <form cForm [formGroup]="createForm" (ngSubmit)="onSubmitCreateForm()">
    <c-modal-body>
      <div class="mb-2 d-flex flex-row">
        <c-form-check class="me-2 d-flex align-items-center">
          <input cFormCheckInput formControlName="isActive" id="isActive" class="me-2" type="checkbox" />
          <label cFormCheckLabel for="isActive" class="me-2">Active </label>
        </c-form-check>
      </div>
      <div class="row mb-2">
        <div class="col-6">
          <label cLabel for="industryId">Select industry: <span class="text-danger">(*)</span></label>
          <select cFormControl formControlName="industryId" cSelect>
            <option value="-1">Select an industry</option>
            @for (item of industryList; track item.id) {
            <option [value]="item.id">{{ item.name }}</option>
            }
          </select>
        </div>
        <div class="col-6">
          <label cLabel for="ipoDate">IPO Date: <span class="text-danger">(*)</span></label>
          <input cFormControl formControlName="ipoDate" type="date" />
        </div>
      </div>
      <div class="mb-2 row">
        <div class="col-6">
          <label cLabel for="name">Name: <span class="text-danger">(*)</span></label>
          <input cFormControl formControlName="name">
          @if (nameCreateForm?.invalid && (nameCreateForm?.dirty || nameCreateForm?.touched)) {
          <div class="text-danger">
            @if (nameCreateForm?.hasError('required')) {
            <div>
              Name is required.
            </div>
            }
          </div>
          }
        </div>
        <div class="col-6">
          <label cLabel for="symbol">Symbol: <span class="text-danger">(*)</span></label>
          <input cFormControl formControlName="symbol">
          @if (symbolCreateForm?.invalid && (symbolCreateForm?.dirty || symbolCreateForm?.touched)) {
          <div class="text-danger">
            @if (symbolCreateForm?.hasError('required')) {
            <div>
              Symbol is required.
            </div>
            }
          </div>
          }
        </div>
      </div>
    </c-modal-body>
    <c-modal-footer>
      <button (click)="toggleLiveCreateModel()" cButton color="secondary">
        Close
      </button>
      <button cButton type="submit" [disabled]="!createForm.valid" color="primary">Save</button>
    </c-modal-footer>
  </form>
</c-modal>
<!-- Update Modal -->
<c-modal backdrop="static" [visible]="visibleUpdateModal" (visibleChange)="handleLiveUpdateModelChange($event)"
  id="verticallyCenteredUpdateModal" size="lg">
  <c-modal-header>
    <h5 cModalTitle>Update Company</h5>
    <button (click)="toggleLiveUpdateModel()" cButtonClose></button>
  </c-modal-header>
  <form cForm [formGroup]="updateForm" (ngSubmit)="onSubmitUpdateForm()">
    <c-modal-body>
      <div class="mb-2 d-flex flex-row">
        <c-form-check class="me-2 d-flex align-items-center">
          <input cFormCheckInput formControlName="isActive" id="isActive" class="me-2" type="checkbox" />
          <label cFormCheckLabel for="isActive" class="me-2">Active </label>
        </c-form-check>
      </div>
      <div class="row mb-2">
        <div class="col-6">
          <label cLabel for="industryId">Select industry: <span class="text-danger">(*)</span></label>
          <select cFormControl formControlName="industryId" cSelect>
            <option value="-1">Select an industry</option>
            @for (item of industryList; track item.id) {
            <option [value]="item.id">{{ item.name }}</option>
            }
          </select>
        </div>
        <div class="col-6">
          <label cLabel for="ipoDate">IPO Date: <span class="text-danger">(*)</span></label>
          <input cFormControl formControlName="ipoDate" type="datetime-local" />
        </div>
      </div>
      <div class="mb-2 row">
        <div class="col-12">
          <label cLabel for="name">Name: <span class="text-danger">(*)</span></label>
          <input cFormControl formControlName="name">
          @if (nameUpdateForm?.invalid && (nameUpdateForm?.dirty || nameUpdateForm?.touched)) {
          <div class="text-danger">
            @if (nameUpdateForm?.hasError('required')) {
            <div>
              Name is required.
            </div>
            }
          </div>
          }
        </div>
        <div class="col-12">
          <label cLabel for="symbol">Symbol: <span class="text-danger">(*)</span></label>
          <input cFormControl formControlName="symbol">
          @if (symbolUpdateForm?.invalid && (symbolUpdateForm?.dirty || symbolUpdateForm?.touched)) {
          <div class="text-danger">
            @if (symbolUpdateForm?.hasError('required')) {
            <div>
              Symbol is required.
            </div>
            }
          </div>
          }
        </div>
      </div>
    </c-modal-body>
    <c-modal-footer>
      <button (click)="toggleLiveUpdateModel()" cButton color="secondary">
        Close
      </button>
      <button cButton type="submit" [disabled]="!updateForm.valid" color="primary">Save</button>
    </c-modal-footer>
  </form>
</c-modal>
<!--Delete Model-->
<c-modal backdrop="static" [visible]="visibleDelete" (visibleChange)="handleLiveDeleteChange($event)"
  id="verticallyCenteredDelete">
  <c-modal-header>
    <h5 cModalTitle>Confirm Delete</h5>
    <button (click)="toggleLiveDelete()" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>
    <p>Are you sure you want to delete this item?</p>
  </c-modal-body>
  <c-modal-footer>
    <button (click)="toggleLiveDelete()" cButton color="secondary">
      Close
    </button>
    <button cButton (click)="onConfirmDelete()" color="primary">Confirm</button>
  </c-modal-footer>
</c-modal>
<!-- Trash Modal -->
<c-modal backdrop="static" [visible]="visibleTrashModal" (visibleChange)="handleLiveTrashModalChange($event)"
  id="verticallyCenteredTrashModal" size="lg">
  <c-modal-header>
    <h5 cModalTitle>Trash Bin</h5>
    <button (click)="toggleLiveTrashModal()" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>
    <app-data-table [data]="trashPageInformation" (changePageIndex)="onTrashPageIndexChange($event)"
      (changePageSize)="onTrashPageSizeChange($event)">
      <thead class="text-nowrap text-truncate">
        <tr>
          <th scope="col">STT</th>
          <th scope="col">Name</th>
          <th scope="col">Symbol</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @for (item of trashData.items; track item.id; let i = $index) {
        <tr>
          <td>{{ i+1 }}</td>
          <td>{{ item.name }}</td>
          <td>{{ item.symbol }}</td>
          <td>
            <div class="d-flex justify-content-end">
              <button (click)="restoreData(item.id)" class="btn btn-success me-2">
                <svg [cIcon]="icons.cilLoopCircular" width="25" class="text-white" title="Restore Icon"></svg>
              </button>
              <button (click)="deleteData(item.id)" class="btn btn-danger">
                <svg [cIcon]="icons.cilTrash" width="25" class="text-white" title="Delete Icon"></svg>
              </button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </app-data-table>
    @if (trashData.items.length === 0) {
    <div class="d-flex justify-content-center">
      <h3 class="opacity-75">No data available!</h3>
    </div>
    }
  </c-modal-body>
</c-modal>