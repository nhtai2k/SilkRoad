<h3>Danh Sách Tài Sản - CCDC</h3>
<c-accordion class="mb-4">
  <c-accordion-item #item0="cAccordionItem" [visible]="true">
    <ng-template cTemplateId="accordionHeaderTemplate">
      <button (click)="item0.toggleItem()" [collapsed]="!item0.visible" cAccordionButton>
        Bộ Lọc:
      </button>
    </ng-template>
    <ng-template cTemplateId="accordionBodyTemplate">
      <div class="accordion-body">
        <div class="row">
          <div class="col-8">
            <form cForm class="w-100" [formGroup]="filterForm" (ngSubmit)="onSubmitFilterForm()">
              <div class="row">
                <div cFormFloating class="mb-2 col-6">
                  <select class="form-control" formControlName="propertyTypeId" cSelect>
                    <option [value]="-1">Tất cả nhóm tài sản</option>
                    <option *ngFor="let item of propertyGroups" [value]="item.id">{{item.name}}</option>
                  </select>
                </div>
                <div cFormFloating class="mb-2 col-6">
                  <app-select-search [options]="unitList" (onChangeValue)="onChangeUnit($event)"
                    placeholder="Tất cả đơn vị tính"></app-select-search>
                </div>
                <div cFormFloating class="mb-2 col-6">
                  <select class="form-control" formControlName="departmentId" cSelect>
                    <option [value]="-1">Tất cả phòng ban</option>
                    <option *ngFor="let item of departmentList" [value]="item.id">{{item.name}}</option>
                  </select>
                </div>
                <div cFormFloating class="mb-2 col-6">
                  <input cInput type="text" formControlName="searchText" class="form-control"
                    placeholder="Enter Code or name...">
                </div>
                <div class="mb-2 col-6 d-flex align-items-end">
                  <button type="submit" class="btn btn-primary w-100">Lọc</button>
                </div>
              </div>
            </form>
          </div>
          <div class="col-4 ">
            <div class="justify-content-end d-flex">
              <button (click)="toggleLiveTrashModal()" class="btn btn-warning me-2">
                <svg [cIcon]="icons.cilTrash" width="25" class="text-white" title="Trash Icon"></svg>
              </button>
              <button (click)="toggleLiveCreateModel()" class="btn btn-success">
                <svg [cIcon]="icons.cilPlus" width="25" class="text-white" title="Plus Icon"></svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </c-accordion-item>
</c-accordion>
<app-data-table [data]="pageInformation" (changePageIndex)="onPageIndexChange($event)"
  (changePageSize)="onPageSizeChange($event)">
  <thead class="text-nowrap text-truncate">
    <tr>
      <th scope="col">STT</th>
      <th scope="col">Hình Ảnh</th>
      <th scope="col">Mã</th>
      <th scope="col">Tên</th>
      <th scope="col">Hoạt Động</th>
      <th scope="col">Tạo Bởi</th>
      <th scope="col">Cập Nhật Bởi</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of data.items; index as i ">
      <td>{{ i+1 }}</td>
      <td>
        <ng-container *ngIf="item.imagePath">
          <img [src]="baseUrl + item.imagePath" alt="Logo" class="img-thumbnail">
        </ng-container>
      </td>
      <td>{{ item.code }}</td>
      <td>{{ item.name }}</td>
      <td>{{ item.isActive }}</td>
      <td>{{ item.createdBy }}</td>
      <td>{{ item.modifiedBy }}</td>
      <td>
        <div class="d-flex justify-content-end">
          <button (click)="updateData(item.id,item.propertyGroupId)" class="btn btn-primary me-2">
            <svg [cIcon]="icons.cilPen" width="25" class="text-white" title="Edit Icon"></svg>
          </button>
          <button (click)="softDeleteData(item.id)" class="btn btn-danger">
            <svg [cIcon]="icons.cilTrash" width="25" class="text-white" title="Delete Icon"></svg>
          </button>
        </div>
      </td>
    </tr>
  </tbody>
</app-data-table>
<!--Delete Model-->
<c-modal backdrop="static" [visible]="visibleDelete" (visibleChange)="handleLiveDeleteChange($event)"
  id="verticallyCenteredDelete">
  <c-modal-header>
    <h5 cModalTitle>Xác Nhận</h5>
    <button (click)="toggleLiveDelete()" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>
    <p>Bạn có chắc là muốn xóa tài sản - CCDC này?</p>
  </c-modal-body>
  <c-modal-footer>
    <button (click)="toggleLiveDelete()" cButton color="secondary">
      Đóng
    </button>
    <button cButton (click)="onConfirmDelete()" color="primary">Xác Nhận</button>
  </c-modal-footer>
</c-modal>
<!-- Trash Modal -->
<c-modal backdrop="static" [visible]="visibleTrashModal" (visibleChange)="handleLiveTrashModalChange($event)"
  id="verticallyCenteredTrashModal" size="lg">
  <c-modal-header>
    <h5 cModalTitle>Thùng Rác</h5>
    <button (click)="toggleLiveTrashModal()" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>
    <app-data-table [data]="trashPageInformation" (changePageIndex)="onTrashPageIndexChange($event)"
      (changePageSize)="onTrashPageSizeChange($event)">
      <thead class="text-nowrap text-truncate">
        <tr>
          <th scope="col">STT</th>
          <th scope="col">Tên</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of trashData.items; index as i ">
          <td>{{ i+1 }}</td>
          <td>{{ item.name }}</td>
          <td>
            <div class="d-flex justify-content-end">
              <button (click)="restoreData(item.id)" class="btn btn-success me-2">
                <svg [cIcon]="icons.cilLoopCircular" width="25" class="text-white" title="Restore Icon"></svg>
              </button>
              <button (click)="deleteData(item.id)" class="btn btn-danger">
                <svg [cIcon]="icons.cilTrash" width="25" class="text-white" title="Delete Icon"></svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </app-data-table>
    <div class="d-flex justify-content-center" *ngIf="trashData.items.length === 0">
      <h3 class="opacity-75">Không có dữ liệu!</h3>
    </div>
  </c-modal-body>
</c-modal>
<!-- Create Model -->
<c-modal backdrop="static" [visible]="visibleCreateModal" (visibleChange)="handleLiveCreateModelChange($event)"
  id="verticallyCenteredCreateModal" size="lg">
  <c-modal-header>
    <h5 cModalTitle>Thêm</h5>
    <button (click)="toggleLiveCreateModel()" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>
    <div class="mb-2">
      <label cLabel for="propertyGroup" class="mb-1">Chọn Nhóm Tài Sản - CCDC: <span
          class="text-danger">(*)</span></label>
      <select cFormControl cSelect [formControl]="propertyGroup" id="propertyGroup" name="propertyGroup">
      <option value="-1">Chọn nhóm tài sản - CCDC</option>
        <option *ngFor="let item of propertyGroups" [value]="item.id">{{item.name}}</option>
      </select>
      <div *ngIf="propertyGroupAttr?.invalid && (propertyGroupAttr?.dirty || propertyGroupAttr?.touched)"
        class="text-danger">
        <div *ngIf="propertyGroupAttr?.hasError('min')">
          Nhóm tài sản - CCDC là bắt buộc.
        </div>
      </div>
    </div>
  </c-modal-body>
  <c-modal-footer>
    <button (click)="toggleLiveCreateModel()" cButton color="secondary">Đóng</button>
    <button cButton [disabled]="propertyGroup.invalid" (click)="onClickCreateProperty()" color="primary">Tiếp Tục</button>
  </c-modal-footer>
</c-modal>

<app-consumable-property #consumablePropertyComponent 
  [departmentList]="departmentList"
  [unitList]="unitList"
></app-consumable-property>

<app-durable-property #durablePropertyComponent 
  [departmentList]="departmentList"
  [unitList]="unitList"></app-durable-property>

<app-energy-consumable-property #energyConsumablePropertyComponent
  [departmentList]="departmentList"
  [unitList]="unitList"
  [energyList]="energyList"
></app-energy-consumable-property>

<app-energy-independent-property #energyIndependentPropertyComponent
  [departmentList]="departmentList"
  [unitList]="unitList"
></app-energy-independent-property>
